<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ks43team03.mapper.LessonMapper">
	<resultMap type="Lesson" id="lessonResultMap">
		<id 	column="lesson_cd" 				property="lessonCd"/>
		<result column="lesson_division" 		property="lessonDivision"/>
		<result column="facility_goods_cd" 		property="facilityGoodsCd"/>
		<result column="facility_cd" 			property="facilityCd"/>
		<result column="goods_ctg_cd" 			property="goodsCtgCd"/>
		<result column="user_id" 				property="userId"/>
		<result column="lesson_nm" 				property="lessonName"/>
		<result column="lesson_detail" 			property="lessonDetail"/>		
		<result column="lesson_total_member" 	property="lessonTotalMember"/>		
 		<result column="lesson_member" 			property="lessonMember"/>		 
		<result column="lesson_start_date" 		property="lessonStartDate"/>		
		<result column="lesson_end_date" 		property="lessonEndDate"/>		
		<result column="lesson_price" 			property="lessonPrice"/>		
		<result column="lesson_reg_date" 		property="lessonRegDate"/>		
		<result column="lesson_state" 			property="lessonState"/>		
		<association property="sports" javaType="Sports">
			<id 	column="sports_cd"	property="sportsCd"/>
			<result column="sports_nm" 	property="sportsName"/>
		</association> 
	</resultMap>
	<!-- 레슨 코드를 사용한 레슨 상세 조회 -->
	<select id="getLessonInfoByCd" parameterType="String" resultMap="lessonResultMap">
		SELECT
			l.lesson_cd,
			l.lesson_division,
			l.facility_goods_cd,
			l.facility_cd,
			l.goods_ctg_cd,
			l.sports_cd,
			l.user_id,
			l.lesson_nm,
			l.lesson_detail,
			l.lesson_total_member,
			l.lesson_price,
			l.lesson_member,
			l.lesson_start_date,
			l.lesson_end_date,
			l.lesson_state,
			l.lesson_reg_date
		FROM
			lesson AS l
		WHERE
			l.lesson_cd = #{lessonCd}
	</select>
	<!-- 시설 내 레슨 조회 -->
	<select id="getFacilityLessonList" fetchSize="100" parameterType="String" resultMap="lessonResultMap">
		SELECT
			l.lesson_cd
			,l.lesson_division
			,l.facility_goods_cd
			,l.facility_cd
			,l.goods_ctg_cd
			,l.sports_cd
			,l.user_id
			,l.lesson_nm
			,l.lesson_detail
			,l.lesson_total_member
			,l.lesson_price
			,l.lesson_member
			,l.lesson_start_date
			,l.lesson_end_date
			,l.lesson_state
			,l.lesson_reg_date
			,s.sports_nm
			,s.sports_cd
		FROM
			lesson AS l
			INNER JOIN
			sports AS s
			on
			l.sports_cd = s.sports_cd
		WHERE
			l.facility_cd = #{facilityCd}
	</select>
	<!-- 레슨 등록 -->
	<insert id="addLesson" parameterType="Lesson">
		INSERT INTO lesson
		(
			lesson_cd					AS lessonCd
			,lesson_division			AS lessonDivision
			,facility_goods_cd			AS facilityGoodsCd
			,facility_cd				AS facilityCd
			,goods_ctg_cd				AS goodsCtgCd
			,sports_cd					AS sportsCd
			,user_id					AS userId
			,sports_nm					AS sportsName
			,lesson_nm					AS lessonName
			,lesson_detail				AS lessonDetail				
			,lesson_total_member		AS lessonTotalMember
			,lesson_start_date			AS lessonStartDate
			,lesson_end_date			AS lessonEndDate
			,lesson_price				AS lessonPrice
			,lesson_reg_date			AS lessonRegDate
		) VALUES (
			,#{lessonCd}
			,#{lessonDivision}
			,#{facilityGoodsCd}
			,#{facilityCd}
			,#{goodsCtgCd}
			,#{sportsCd}
			,#{userId}
			,#{sportsName}
			,#{lessonName}
			,#{lessonDetail}
			,#{lessonTatalMember}
			,#{lessonStartDate}
			,#{lessonEndDate}
			,#{lessonPrice}
			,NOW()
		)
	</insert>
</mapper>